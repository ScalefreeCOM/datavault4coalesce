fileVersion: 1
id: "datavault4coalesce__databricks_reference_satellite_v1_create"
macroString: |-
  {#-- Utility macro: outputs a SQL function to create a Reference Satellite V1. --#}
  {%- macro datavault4coalesce__databricks_reference_satellite_v1_create(node, columns) -%}

    {% if node.override.create.enabled %}
      {{ node.override.create.script }}
    {% endif %}  
    {{ stage('Create Satellite View') }}

    CREATE OR REPLACE VIEW {{ ref_no_link(node.location.name, node.name) }}
    (
        {% for col in columns %}
          `{{ col.name }}`
        {%- if col.description | length > 0 %} COMMENT '{{ col.description | escape }}'{% endif %}
            {%- if not loop.last -%}, {% endif %}
        {% endfor %}
    )
      {%- if node.description | length > 0 %} COMMENT = '{{ node.description | escape }}'{% endif %}

    AS
    {% for source in sources %}
        SELECT
        {% for col in source.columns %}
            {{ get_source_transform(col) }} AS `{{ col.name }}`
            {%- if not loop.last -%}, {% endif %}
        {% endfor %}
        {{ source.join }}
    {% endfor %}
  {%- endmacro -%}
name: datavault4coalesce__databricks_reference_satellite_v1_create
type: Macro