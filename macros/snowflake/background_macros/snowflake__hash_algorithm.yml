fileVersion: 1
id: datavault4coalesce__snowflake_hash_algorithm
macroString: |- 

  {#---------------------------------------------------------------------------------------------#}
  {#-- DV Utility macro: Hashing algorithm.                                                    --#}
  {#--                                                                                         --#}
  {#-- Outputs hashing algorithm and Snowflake function to calculate hashes based on  --#}
  {#-- If parameters are empty, default options in global variables will be used. --#}
  {#-- Usage: main hashing macro datavault4coalesce__hash                                      --#}
  {#--        and macro for ghost record datavault4coalesce__ghost_record_per_datatype         --#}
  {#--                                                                                         --#}
  {#-- Parameters:                                                                             --#}
  {#--     hash_function: hashing algorithm.                                                   --#}
  {#--     hash_datatype: datatype of hash column.                                             --#}
  {#---------------------------------------------------------------------------------------------#}
  {%- macro datavault4coalesce__snowflake_hash_algorithm(hash_function=none, hash_datatype=none) -%}

       {%- if hash_function is none -%}
            {%- set hash_function = datavault4coalesce.config.hash -%}
       {%- endif -%}
       {%- if hash_datatype is none -%}
            {%- set hash_datatype = datavault4coalesce.config.hash_datatype -%}
       {%- endif -%}  

       {%- set dict_result = {} -%}
       {%- set hash_alg = '' -%}

       {%- if hash_function == 'MD5' -%}
            {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                 {%- set hash_alg = 'MD5' -%}
            {%- elif 'BINARY' in hash_datatype -%}
                 {%- set hash_alg = 'MD5_BINARY' -%}       
            {%- endif -%}
       {%- elif hash_function == 'SHA1' or hash_function == 'SHA1_HEX' or hash_function == 'SHA' -%} 
            {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                 {%- set hash_alg = 'SHA1' -%}
            {%- elif 'BINARY' in hash_datatype -%}
                 {%- set hash_alg = 'SHA1_BINARY' -%}       
            {%- endif -%}
       {%- elif hash_function == 'SHA2' or hash_function == 'SHA2_HEX' or hash_function == 'SHA256' -%}
            {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                 {%- set hash_alg = 'SHA2' -%}
            {%- elif 'BINARY' in hash_datatype -%}
                 {%- set hash_alg = 'SHA2_BINARY' -%}       
            {%- endif -%}   
       {%- endif -%}

       {{ hash_alg }}

  {%- endmacro -%}
name: datavault4coalesce__snowflake_hash_algorithm
type: Macro