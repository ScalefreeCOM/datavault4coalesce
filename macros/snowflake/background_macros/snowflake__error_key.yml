fileVersion: 1
id: "4"
macroString: |-

     {#---------------------------------------------------------------------------------------------#}
     {#-- DV Utility macro: Output error zero key for ghost record.                               --#}
     {#--                                                                                         --#}
     {#-- Generates error zero key based on the hashing algorithm being used for ghost records.   --#}
     {#-- Usage: main hashing macro datavault4coalesce__hash                                      --#}
     {#--        and macro for ghost record datavault4coalesce__ghost_record_per_datatype         --#}
     {#--                                                                                         --#}
     {#-- Parameters:                                                                             --#}
     {#--     hash_function: hashing algorithm.                                                   --#}
     {#--     hash_datatype: datatype of hash column.                                             --#}
     {#---------------------------------------------------------------------------------------------#}
     {%- macro datavault4coalesce__snowflake_error_key(hash_function=none, hash_datatype=none) -%}
          {%- if hash_function is none -%}
               {%- set hash_function = datavault4coalesce.config.hash -%}
          {%- endif -%}
          {%- if hash_datatype is none -%}
               {%- set hash_datatype = datavault4coalesce.config.hash_datatype -%}
          {%- endif -%}  

          {%- set dict_result = {} -%}
          {%- set error_key = '' -%}

          {%- if hash_function == 'MD5' -%}
               {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                    {%- set error_key = '!ffffffffffffffffffffffffffffffff' -%}
               {%- elif 'BINARY' in hash_datatype -%}  
                    {%- set error_key = "TO_BINARY('ffffffffffffffffffffffffffffffff')" -%}     
               {%- endif -%}          
          {%- elif hash_function == 'SHA1' or hash_function == 'SHA1_HEX' or hash_function == 'SHA' -%} 
               {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                    {%- set error_key = '!ffffffffffffffffffffffffffffffffffffffff' -%}
               {%- elif 'BINARY' in hash_datatype -%}
                    {%- set error_key = "TO_BINARY('ffffffffffffffffffffffffffffffffffffffff')" -%}        
               {%- endif -%}
          {%- elif hash_function == 'SHA2' or hash_function == 'SHA2_HEX' or hash_function == 'SHA256'  -%}
               {%- if 'VARCHAR' in hash_datatype or 'CHAR' in hash_datatype or 'STRING' in hash_datatype or 'TEXT' in hash_datatype %}
                    {%- set error_key = '!ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff' -%}
               {%- elif 'BINARY' in hash_datatype -%}
                    {%- set error_key = "TO_BINARY('ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff')" -%}        
               {%- endif -%}   
          {%- endif -%}

          {% set error_key = datavault4coalesce__snowflake_as_constant(error_key) %}
          {{ error_key }}
     {%- endmacro -%}
name: snowflake__error_key
type: Macro