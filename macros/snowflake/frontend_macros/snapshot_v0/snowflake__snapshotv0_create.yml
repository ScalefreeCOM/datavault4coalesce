fileVersion: 1
id: "13-create"
macroString: |-
  {#-- Utility macro: outputs a SQL function to create a snapshot v0 table. --#}
  {%- macro datavault4coalesce__snowflake_snapshot_v0_create(node, columns) -%}

    {% if node.override.create.enabled %}
      {{ node.override.create.script }}
    {% endif %}
    {{ stage('Create Snapshot v0 Table') }}

      CREATE OR REPLACE TABLE {{ ref_no_link(node.location.name, node.name) }}
      (
        {% for col in columns %}
          "{{ col.name }}" {{ col.dataType }}
          {%- if not col.nullable %} NOT NULL
            {%- if col.defaultValue | length > 0 %} DEFAULT {{ col.defaultValue }}{% endif %}
          {% endif %}
          {%- if col.description | length > 0 %} COMMENT '{{ col.description | escape }}'{% endif %}
          {%- if not loop.last -%}, {% endif %}
        {% endfor %}
      )
      {%- if node.description | length > 0 %} COMMENT = '{{ node.description | escape }}'{% endif %}
    {%- endmacro -%}
name: datavault4coalesce__snowflake_snapshot_v0_create
type: Macro